id: Multi IdP JWT Validation
name: Multi IdP JWT Validation
description: |
  ğŸ” **Multi-IdP JWT Validation Policy**

  This policy validates JSON Web Tokens (JWTs) from multiple Identity Providers (IdPs). It provides robust and flexible security features including:
  âœ… **JWKS URL Fallback:** Validates JWT against multiple JWKS endpoints in sequence.
  âœ… **Flexible Claim Validation:** Supports verification of both header and payload claims with single or multiple expected values (comma-separated).
  âœ… **Optional Checks:** Allows selective enforcement of JWT standard claims (`exp`, `nbf`, `jti`).

  ğŸ›ˆ **Usage Guide:**
  - Provide JWKS endpoints as a comma-separated list in `urlsCsv`.
  - Add any standard or custom JWT claim directly as a parameter.
  - ğŸ”„ All **string-type** claims support multiple expected values using commas â†’ `alg: RS256,RS512`, `sub: userA,userB`.
  - Leave any field empty if that claim should not be enforced.

category: Custom
type: custom
standalone: true
supportedJavaVersions: ["8", "11", "17"]
requiresConnectivity: true
encryptionSupported: true
resourceLevelSupported: true
providedCharacteristics: []
requiredCharacteristics: []

configuration:

- propertyName: documentation
  name: ğŸ” Usage & Behavior (Read-only Info)
  description: |
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  
    ğŸ” **Multi-IdP JWT Validation Policy**
    
    This policy validates JWT tokens issued by **multiple Identity Providers** using a flexible fallback strategy.
  
    ğŸ’¡ **How It Works**
    - Accepts a comma-separated list of JWKS URLs via `urlsCsv`, trying each in order until a valid key is found.
    - Validates standard and custom claims from both JWT **header** (e.g., `alg`, `x5t`, `typ`, `kid`) and **payload** (e.g., `sub`, `iss`, `scope`, `vivo.env`, etc.).
    - Each claim field supports **multiple expected values**, separated by commas â†’ `RS256,RS512` or `userA,userB`.
  
    ğŸ§© **What You Can Configure**
    - ğŸ”§ Enable or disable validation for `exp`, `nbf`, or `jti` (JWT core claims).
    - ğŸ”„ Skip or enforce client ID checks (`skipClientIdValidation`).
    - ğŸ“‹ Specify as many claim key/value pairs as needed.
    - ğŸ›¡ï¸ Block replay attacks with required `jti`.
  
    ğŸ“ **Examples**
    - âœ… `alg: RS256,RS512` â€“ accepts both algorithms.
    - âœ… `iss: https://auth1.example.com,https://auth2.example.com`
    - âœ… `scope: ServiceAccount.Profile,UserAccount.Profile`
    - âœ… `sub: user1,user2,user3`
  
    ğŸ“Œ **Empty fields mean the claim will be skipped**, so only fill whatâ€™s needed.
  
    ğŸ“¥ **Ideal for:**
    - B2B/B2C APIs that receive tokens from multiple trusted sources.
    - Environments requiring conditional or fallback JWT verification.
    - Enhancing security with multi-key validation paths.
    
    
    ğŸ”š End of Policy Description
    
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  type: object
  optional: true

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ—‚ï¸ Sistema (Radio Buttons)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- propertyName: usingSystem
  name: "ğŸ—‚ï¸ Sistema Utilizado"
  description: |
    Identifica **em qual sistema** esta policy estÃ¡ sendo usada.

    ğŸ’¡ Os Ã­cones ajudam a identificar rapidamente o contexto:
    - "ğŸ´ MULE" â†’ APIs MuleSoft
    - "ğŸ§¬ SFA" â†’ Salesforce Automation
    - "ğŸ”— KAFKA" â†’ Event Streaming
    - "ğŸ“¦ ROM" â†’ LogÃ­stica ROM
    - ...

    Use para rastreabilidade e padronizaÃ§Ã£o dos fluxos.
  type: radio
  options:
    - name: "ğŸ´ MULE"
      value: "MULE"
    - name: "ğŸ§¬ SFA"
      value: "SFA"
    - name: "ğŸš COM"
      value: "COM"
    - name: "ğŸ§« SOM"
      value: "SOM"
    - name: "ğŸ§¾ BRM"
      value: "BRM"
    - name: "ğŸ”— KAFKA"
      value: "KAFKA"
    - name: "ğŸ“¦ ROM"
      value: "ROM"
    - name: "ğŸ“Š SPL"
      value: "SPL"
    - name: "ğŸ“‹ WFM"
      value: "WFM"
    - name: "ğŸš SIGITM"
      value: "SIGITM"
    - name: "ğŸš SIGSEUM"
      value: "SIGSEUM"
    - name: "ğŸ’³ SMARTBILL"
      value: "SMARTBILL"
    - name: "ğŸš€ HYPER"
      value: "HYPER"
    - name: "ğŸ’ª OSS"
      value: "OSS"
    - name: "ğŸ§· HUBPAG"
      value: "HUBPAG"
    - name: "ğŸ§ª MVE"
      value: "MVE"
    - name: "ğŸ§« ROUTER"
      value: "ROUTER"
    - name: "ğŸ“Š ODP"
      value: "ODP"
    - name: "ğŸ§¾ FRM"
      value: "FRM"
    - name: "âœï¸ CLICKSIGN"
      value: "CLICKSIGN"
    - name: "ğŸ¦ KENAN"
      value: "KENAN"
    - name: "ğŸ—’ï¸ GDOC"
      value: "GDOC"
    - name: "ğŸ›¡ï¸ VPD"
      value: "VPD"
    - name: "ğŸ¤ PARCEIROS"
      value: "PARCEIROS"
    - name: "ğŸ§± CSS"
      value: "CSS"
    - name: "ğŸ’¼ APP/ECOMM"
      value: "APP/ECOMM"
    - name: "ğŸª  PCO"
      value: "PCO"
    - name: "ğŸ¤– VICKY"
      value: "VICKY"
  optional: false
  sensitive: false

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸŒ JWKS Configuration
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- propertyName: urlsCsv
  name: JWKS URLs (CSV)
  description: |
    ğŸŒ **Comma-separated JWKS endpoints tested sequentially.**
    Example: `https://auth1.example.com/jwks,https://backup.example.com/jwks`
  type: string
  optional: false

- propertyName: timeoutMillis
  name: Timeout (ms)
  description: â±ï¸ **Timeout in milliseconds for each JWKS request.**
  type: number
  optional: true
  defaultValue: 50000

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”‘ Header Claims Validation
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- propertyName: alg
  name: Header â€¢ alg
  description: |
    ğŸ” **Expected JWT algorithm (alg claim).** CSV supported.
    Example: `RS256,RS512`
  type: string
  optional: true

- propertyName: kid
  name: Header â€¢ kid
  description: |
    ğŸ”‘ **Key ID from JWKS.** CSV supported.
    Example: `key1,key2`
  type: string
  optional: true

- propertyName: typ
  name: Header â€¢ typ
  description: |
    ğŸ·ï¸ **JWT token type.** CSV supported.
    Example: `JWT,JWS`
  type: string
  optional: true

- propertyName: x5t
  name: Header â€¢ x5t
  description: |
    ğŸ” **X.509 certificate thumbprint (x5t).** CSV supported.
    Example: `MzYwXFzLObCcjKsRxEmSjIA3_VU`
  type: string
  optional: true

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“„ Critical Payload Claims Validation
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- propertyName: iss
  name: Payload â€¢ iss
  description: |
    ğŸŒ **Issuer of the JWT.** CSV supported.
    Example: `https://issuer.example.com,https://backup-issuer.example.com`
  type: string
  optional: true

- propertyName: oracleOauthRtTtc
  name: Payload â€¢ Oracle OAuth RT TTC
  description: |
    ğŸ” Expected value(s) for the `oracle.oauth.rt.ttc` claim.
    Provide one or more comma-separated values. If the tokenâ€™s `oracle.oauth.rt.ttc` claim
    does not match any, validation fails when `validateCustomClaims` is true.
  type: string
  optional: true

- propertyName: sub
  name: Payload â€¢ sub
  description: |
    ğŸ‘¤ **Subject claim.** CSV supported.
    Example: `userA,userB`
  type: string
  optional: true

- propertyName: oracle.oauth.scope
  name: Payload â€¢ oracle.oauth.scope
  description: |
    ğŸ”– **OAuth scopes associated.** CSV supported.
    Example: `ServiceAccount.Profile,UserAccount.Profile`
  type: string
  optional: true

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ¢ Business Payload Claims
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- propertyName: vivo.env
  name: Payload â€¢ vivo.env
  description: |
    ğŸ·ï¸ **Environment identifier.** CSV supported.
    Example: `CORP-HML,CORP-DEV`
  type: string
  optional: true

- propertyName: vivo.endpoint
  name: Payload â€¢ vivo.endpoint
  description: |
    ğŸ“ **API endpoint identifier.** CSV supported.
    Example: `vivooauthservice,vivoapiservice`
  type: string
  optional: true

- propertyName: oracle.oauth.user_origin_id
  name: Payload â€¢ oracle.oauth.user_origin_id
  description: |
    ğŸ”– **User origin ID.** CSV supported.
    Example: `svc_apigwint_redes`
  type: string
  optional: true
  
- propertyName: aud
  name: Payload â€¢ aud
  description: |
    ğŸ¯ **Audience claim (aud).** CSV supported.
    Example: `VivoCustomerProfile,Customer,https://authhml.vivo.com.br:443/oauth2`
  type: string
  optional: true

- propertyName: oracle.oauth.user_origin_id_type
  name: Payload â€¢ oracle.oauth.user_origin_id_type
  description: |
    ğŸ”– **User origin ID type.** CSV supported.
    Example: `LDAP_UID,USER_ID`
  type: string
  optional: true

- propertyName: oracle.oauth.svc_p_n
  name: Payload â€¢ oracle.oauth.svc_p_n
  description: |
    ğŸ› ï¸ **Service profile name.** CSV supported.
    Example: `VivoServiceProfile,AdminServiceProfile`
  type: string
  optional: true

- propertyName: oracle.oauth.tk_context
  name: Payload â€¢ oracle.oauth.tk_context
  description: |
    ğŸ“Œ **Token context.** CSV supported.
    Example: `resource_access_tk,login_access_tk`
  type: string
  optional: true

- propertyName: oracle.oauth.client_origin_id
  name: Payload â€¢ oracle.oauth.client_origin_id
  description: |
    ğŸ†” **Client origin ID.** CSV supported.
    Example: `5728d15b019e473fb3b81354bb793c9d,123456789abcdef`
  type: string
  optional: true

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ•’ Technical Payload Claims
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- propertyName: clientIdExpression
  name: Payload â€¢ Client ID Expression
  description: |
    ğŸ“› Comma-separated list of JWT claim names used to extract the Client ID dynamically from the token payload.

    ğŸ” This is used only if Client-ID validation is enabled and supports fallback across multiple keys.

    âœ… Examples:
      - `client_id`
      - `client`
      - `sub`
      - `client_id,client` â†’ will check `client_id`, and if not found, fallback to `client`.

    ğŸ“Œ These values will be searched in the token payload by the `extract-client-id` operation,
    and the first non-empty match will be used for validation.
  type: string
  optional: true

- propertyName: client
  name: Payload â€¢ client
  description: |
    ğŸ”‘ **Client ID from token payload.** CSV supported.
    Example: `43fc60f754f54b72b35db5a9902d80c1`
  type: string
  optional: true

- propertyName: entryUUID
  name: Payload â€¢ entryUUID
  description: |
    ğŸ”‘ **Entry UUID for tracking.** CSV supported.
    Example: `e49f1e6d-c9e9-4870-8005-d4c7f2826dcb`
  type: string
  optional: true

- propertyName: firstname
  name: Payload â€¢ firstname
  description: |
    ğŸ‘¤ **First name of user.** CSV supported.
    Example: `Alice,Bob`
  type: string
  optional: true

- propertyName: lastname
  name: Payload â€¢ lastname
  description: |
    ğŸ‘¥ **Last name or email (if used as alias).** CSV supported.
    Example: `user@example.com`
  type: string
  optional: true

- propertyName: mail
  name: Payload â€¢ mail
  description: |
    ğŸ“§ **Email address of the user.** CSV supported.
    Example: `user@example.com`
  type: string
  optional: true

- propertyName: nrdocumento
  name: Payload â€¢ nrdocumento
  description: |
    ğŸšª **User document number.** CSV supported.
    Example: `84619246069`
  type: string
  optional: true

- propertyName: documentocliente
  name: Payload â€¢ documentocliente
  description: |
    ğŸ“„ **Redundant document ID.** CSV supported.
    Example: `84619246069`
  type: string
  optional: true

- propertyName: uid
  name: Payload â€¢ uid
  description: |
    ğŸ“… **LDAP Unique ID.** CSV supported.
    Example: `84619246069B2B`
  type: string
  optional: true

- propertyName: commonname
  name: Payload â€¢ commonname
  description: |
    ğŸ“ **Common name identifier.** CSV supported.
    Example: `84619246069B2B`
  type: string
  optional: true

- propertyName: authorizedservices
  name: Payload â€¢ authorizedservices
  description: |
    âš–ï¸ **Authorized service list.** CSV supported.
    Example: `serviceA,serviceB`
  type: string
  optional: true

- propertyName: tvdesignador
  name: Payload â€¢ tvdesignador
  description: |
    ğŸ¡ **Vivo-specific field: tvdesignador.** CSV supported.
    Example: `code1,code2`
  type: string
  optional: true

- propertyName: tvdesignadorpreferido
  name: Payload â€¢ tvdesignadorpreferido
  description: |
    ğŸ”¹ **Preferred designator for TV.** CSV supported.
    Example: `main,default`
  type: string
  optional: true

- propertyName: description
  name: Payload â€¢ description
  description: |
    ğŸ”– **Optional description field.** CSV supported.
    Example: `some info here`
  type: string
  optional: true

- propertyName: iat
  name: Payload â€¢ iat
  description: |
    ğŸ•“ **Issued-at time (epoch seconds).**
    Example: `1747084595`
  type: string
  optional: true

- propertyName: jti
  name: Payload â€¢ jti
  description: |
    ğŸ†” **JWT ID for replay protection.** CSV supported.
    Example: `84e75068-d285-48b7-84d8-49f24b3c4158,abcd1234-5678-90ef-ghij-klmnopqrstuv`
  type: string
  optional: true

- propertyName: oracle.oauth.id_d_id
  name: Payload â€¢ oracle.oauth.id_d_id
  description: |
    ğŸ”– **Identity domain ID.** CSV supported.
    Example: `6344ad2b-18b2-458d-8762-aecdfc63be10`
  type: string
  optional: true
  
- propertyName: domain
  name: Payload â€¢ domain
  description: |
    ğŸŒ **Domain** field from JWT payload. CSV supported.
    Example: `VivoCustomerDomain,VivoServiceDomain`
  type: string
  optional: true
  
- propertyName: vivoLKRS
  name: Payload â€¢ vivoLKRS
  description: |
    ğŸ§¬ **vivoLKRS** custom claim from JWT payload. CSV supported.
    Example: `MC0xNzM5MjkyMDU3MDY2`
  type: string
  optional: true

- propertyName: oracle.oauth.prn.id_type
  name: Payload â€¢ oracle.oauth.prn.id_type
  description: |
    ğŸ“‡ **Principal ID type.** CSV supported.
    Example: `LDAP_UID,USER_ID`
  type: string
  optional: true

- propertyName: prn
  name: Payload â€¢ prn
  description: |
    ğŸ§‘â€ğŸ’» **Principal value.** CSV supported.
    Example: `SVC_MULESOFT,SVC_USER`
  type: string
  optional: true

- propertyName: user.tenant.name
  name: Payload â€¢ user.tenant.name
  description: |
    ğŸ¢ **Tenant name.** CSV supported.
    Example: `Vivo,Telefonica`
  type: string
  optional: true

- propertyName: customClaimsKey
  name: "ğŸ”‘ Claims â€“ key(s)"
  description: |
    ğŸ§© **Claim names to validate** from the JWT.

    ğŸ‘‰ You can provide:
    â€¢ A single claim  
      `kid`

    â€¢ Or multiple claim names, separated by commas  
      `alg,kid,typ`

    ğŸ“Œ Keys are matched **positionally** with the values from the next field  
    (see "ğŸ§ª Claims â€“ value(s)").

    â– Leave this field empty to skip custom claim validation.
  type: string
  optional: true

- propertyName: customClaimsValue
  name: "ğŸ§ª Claims â€“ value(s)"
  description: |
    ğŸ¯ **Expected values** for the claims listed above.

    ğŸ‘‰ You can enter:
    â€¢ A single value  
      `RS512`

    â€¢ Or multiple values, comma-separated  
      `RS512,orakey`

    ğŸ§  Matching rules:
    â€¢ âœ… Position matters â†’ `alg,kid` matches `RS512,orakey`  
    â€¢ ğŸ” If there are **more keys than values**, the **last value is reused**  
    â€¢ ğŸ”½ A comma inside a value means "**accept any of these**"  
      Example: `admin,user` will pass if claim = `admin` **or** `user`

    â– Leave this field empty to skip additional validations.
  type: string
  optional: true

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸš© Runtime Flags
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- propertyName: enableLogging
  name: Enable Extension Logging
  description: |
    ğŸ“ **Toggle detailed extension logs on or off.**  
    When **true**, the extension will print comprehensive debug messages to the console, including:  
    â€¢ JWKS fetch attempts and results  
    â€¢ JWT signature and claim validation steps  
    â€¢ Client-ID extraction details  
    â€¢ Any unexpected errors  
    ğŸ” **Examples:**  
    - `true` â†’ youâ€™ll see all â€œ[JWT-Fallback] â€¦â€ log lines during execution  
    - `false` (default) â†’ only errors or higher-level policy logs will appear  
    ğŸ’¡ **Use case:**  
    - Enable in development or troubleshooting  
    - Disable in production to reduce noise and improve performance  
  type: boolean
  optional: true
  defaultValue: false

- propertyName: requireExpiration
  name: Require Expiration (exp)
  description: ğŸ•’ **Enforce JWT expiration claim (exp).**
  type: boolean
  optional: true
  defaultValue: true

- propertyName: requireNotBefore
  name: Require Not-Before (nbf)
  description: ğŸš¦ **Validate not-before claim (nbf).**
  type: boolean
  optional: true
  defaultValue: false

- propertyName: requireJWTId
  name: Require JWT ID (jti)
  description: ğŸ›¡ï¸ **Enforce JWT ID claim (jti).**
  type: boolean
  optional: true
  defaultValue: false

- propertyName: skipClientIdValidation
  name: Skip Client-ID Validation
  description: âš ï¸ **Skip API Manager client ID enforcement.**
  type: boolean
  optional: true
  defaultValue: true
  
- propertyName: validateCustomClaims
  name: Validate Custom Claims
  description: |
    ğŸ” **Enables validation of custom claims in the JWT, in addition to standard fields (`exp`, `nbf`, `jti`).**

    When set to `true`, this property activates a secondary validation layer that inspects user-defined claim entries from the `<custom-claims>` block or `customClaims` property.

    ---
    âœ… **Behavior:**
    - Each entry in `customClaims` is treated as a required condition. The policy will iterate through each claim key-value pair and verify:
      - The claim is present in the token payload.
      - Its value matches the expected value(s) provided (single or comma-separated for multiple options).
    - Value matching is **case-sensitive** and type-aware (`String`, `Number`, `Array`, etc.).
    - If any expected claim is missing, or its value does not match, the token will be rejected with `401 Unauthorized`.

    ---
    âš ï¸ **Important behavior when `true` and `customClaims` is empty:**
    - If `validateCustomClaims = true` and the `customClaims` block is either:
      - Empty (`<custom-claims></custom-claims>`)
      - Not provided at all (`{}` or `[]`)
    - Then **the validation will fail by default**. This is intentional:
      - The policy assumes custom claim validation was required but misconfigured.
      - This protects against silent misconfigurations that would otherwise allow tokens with insufficient claims.

    In this case, the following error will be returned:
    ```
    JWT validation failed: custom claim set was expected but not provided.
    ```

    ---
    ğŸš« **If `validateCustomClaims = false`:**
    - The `customClaims` block will be completely ignored.
    - Only standard JWT validation applies (`exp`, `nbf`, `jti` depending on other flags).
    - This setting is useful when the gateway is only responsible for cryptographic validation and expiration checks, while business logic is handled downstream.

    ---
    ğŸ“Œ **Usage examples:**
    ```xml
    <jwt-fallback:custom-claims>
      <jwt-fallback:custom-claim key="aud" value="MyClientId"/>
      <jwt-fallback:custom-claim key="scope" value="read,write"/>
      <jwt-fallback:custom-claim key="iss" value="https://idp1.com,https://idp2.com"/>
    </jwt-fallback:custom-claims>
    ```

    ---
    ğŸ§  **Best practices:**
    - Always provide a valid set of claims when `validateCustomClaims` is `true`.
    - Use for enforcing identity boundaries, tenant isolation, RBAC-like behavior, or per-client validations.
    - When working with multiple IdPs, customize claims according to the expected JWT format per IdP.

  type: boolean
  optional: true
  defaultValue: true